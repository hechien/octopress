<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 時間 | 赫謙小便籤]]></title>
  <link href="http://hechien.github.com/octopress/blog/categories/時間/atom.xml" rel="self"/>
  <link href="http://hechien.github.com/octopress/"/>
  <updated>2012-07-30T15:32:11+08:00</updated>
  <id>http://hechien.github.com/octopress/</id>
  <author>
    <name><![CDATA[赫謙]]></name>
    <email><![CDATA[hechien@me.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails 的 DateTime#change]]></title>
    <link href="http://hechien.github.com/octopress/blog/change-datetime-by-change-in-rails/"/>
    <updated>2012-07-25T16:38:00+08:00</updated>
    <id>http://hechien.github.com/octopress/blog/change-datetime-by-change-in-rails</id>
    <content type="html"><![CDATA[<p>最近在寫一個東西，要取得時間並且扔到SQL內做BETWEEN運算，所以我這樣寫</p>

<pre><code>    now = Time.now
    objs = Obj.where({created_at: (now..(now+1.minutes))})
</code></pre>

<p>這樣執行後我發現會有問題，因為我其實只要把精準度調到分鐘，但是傳入的卻是到秒，也就是說我要的是類似 <code>2012-01-01 10:20:00</code> 這樣的格式，但是傳入的會是 <code>2012-01-01 10:20:30</code> 這樣的格式</p>

<p>所以為了解決這個辦法，我只好寫了很髒的code</p>

<pre><code>    now = Time.now; now -= now.sec.seconds
</code></pre>

<p>這真的夠髒了 ...</p>

<p>後來為了某個功能(也許下篇會說)跑去APIDock查API，發現到Rails擴充了<code>DateTime</code>加入了<code>change</code>這個功能，才發現原來我API真的不熟啊 ... Orz</p>

<p>所以要怎麼用呢？</p>

<p>假設我現在時間是<code>2012-01-02 03:04:05</code>，想要把秒數改為<code>30</code>的話，我可以這樣做：</p>

<pre><code>    now = "2012-01-02 03:04:05"
    now.change({sec: 30})
</code></pre>

<p>除了改秒數，也能改年份，所有可以改的參數：</p>

<ul>
<li>year</li>
<li>month</li>
<li>day</li>
<li>hour</li>
<li>min</li>
<li>sec</li>
<li>offset</li>
<li>start</li>
</ul>


<p>但是要注意，如果修改時間部分的話(也就是<code>hour</code>、<code>min</code>、<code>sec</code>)會根據順序去重新設定值。這是什麼意思呢？</p>

<p>假設我只修改<code>hour</code>的話，會把<code>min</code>跟<code>sec</code>給改為<code>00</code>；如果我只修改<code>min</code>的話，那只有<code>sec</code>會被改變為<code>00</code>。</p>

<p>所以如果我只要修改<code>hour</code>而其餘不變的話，就得把整個<code>hour</code>,<code>min</code>,<code>sec</code>都給傳進去才會正常。</p>

<p><div><script src='https://gist.github.com/3155780.js?file=test.rb'></script>
<noscript><pre><code>now = Time.now
#=&gt; 2012-07-21 21:08:55 +0800

now.change({year: 2015})
#=&gt; 2015-07-21 21:08:55 +0800

now.change({min: 30})
#=&gt; 2012-07-21 21:30:00 +0800

now.change({hour: 14, min: 10})
#=&gt; 2012-07-21 14:10:00 +0800</code></pre></noscript></div>
</p>
]]></content>
  </entry>
  
</feed>

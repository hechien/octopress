
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>赫謙小便籤</title>
    <meta name="author" content="赫謙">

    
    <meta name="description" content="RVM與cron 今天發生了一件事情，crontab設定的task不能正常的跑Ruby script，檢查一下原以為是Path的問題，不管怎樣設定Path都會沒辦法正常的load rubygems，後來找了一下後發現原來官方就有教學了 &#8230; 總之，把cron內加上rvm &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="http://feeds.feedburner.com/hechienstickies" rel="alternate" title="赫謙小便籤" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/octopress/favicon.png" rel="shortcut icon">
    <link href="/octopress/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="/octopress/javascripts/html5.js"></script><![endif]-->
    <script src="/octopress/javascripts/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9528313-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<header class="inner"><h1 class="left"><a href="/octopress/">赫謙小便籤</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/octopress/">Blog</a></li>
	<li><a href="/octopress/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:hechien.github.com/octopress">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/HeChian" title="Twitter">Twitter</a>
		
		
		<a class="rss" href="http://feeds.feedburner.com/hechienstickies" title="RSS">RSS</a>
		
	</div>
</div>
</header>
	
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/HeChian">HeChian</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/octopress/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('HeChian', 5);
	})(jQuery);
</script>

	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/rvmyu-cron/">RVM與cron</a></h1>
    <div class="entry">
        <p>今天發生了一件事情，crontab設定的task不能正常的跑Ruby script，檢查一下原以為是Path的問題，不管怎樣設定Path都會沒辦法正常的load rubygems，後來找了一下後發現原來官方就有<a href="http://beginrescueend.com/integration/cron/">教學</a>了 &#8230;</p>

<p>總之，把cron內加上rvm ruby的路徑就可以了</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-24T11:40:00+08:00" pubdate data-updated="true">Apr 24<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/cron/'>cron</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/ruby/'>ruby</a>, <a class='category' href='/octopress/blog/categories/rvm/'>rvm</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/ruby-load-pathshe-ding/">Ruby Load Path設定</a></h1>
    <div class="entry">
        

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="c1">#encoding: utf-8</span>
</span><span class='line'><span class="vg">$LOAD_PATH</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;.&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;kdan_mobile&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-24T11:33:00+08:00" pubdate data-updated="true">Apr 24<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/ruby/'>ruby</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/node-dot-jsxie-tcp-socket-server/">node.js寫TCP Socket Server</a></h1>
    <div class="entry">
        <p>最近正苦惱著要怎樣加快API的回應速度，後來把腦筋動到一般的Socket上，打算直接寫個Socket Server負責回應API Request &#8230; 我看人家<a href="http://www.inside.com.tw/2012/01/10/group-chatting">Whatsapp用Erlang搞定兩百二十萬條的連線數</a>，但是我不會寫Erlang啊！</p>

<p>所以只好先把腦筋動到node.js上面，然後稍微Google了一下後便寫出了底下的東西 &#8230;</p>


        
        <a href="/octopress/blog/node-dot-jsxie-tcp-socket-server/" class="more-link">繼續閱讀 &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-24T09:40:00+08:00" pubdate data-updated="true">Apr 24<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/tcp-server/'>TCP Server</a>, <a class='category' href='/octopress/blog/categories/node-js/'>node.js</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/railsda-suo-yin-ji-qiao/">Rails打索引技巧</a></h1>
    <div class="entry">
        <p>做專案學到的一個技巧 &#8230; 應該說，是很慘痛的學到一個技巧=_= &#8230;</p>

<p>我們都知道，Rails可以透過<code>rails g migration blahblah</code>來產生Migration file然後在裡面寫<code>add_index</code>來打索引，可是切記切記！！不要把索引寫在同一個表內 &#8230; 當資料量大，而且其中一個index打失敗你就會哭了 &#8230;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Mysql2::Error: Specified key was too long; max key length is 1000 bytes: CREATE  INDEX `index_products_on_url_identify_and_name` ON `products` (`url_identify`, `name`)</span></code></pre></td></tr></table></div></figure>


<p>慘痛T_T</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-24T09:36:00+08:00" pubdate data-updated="true">Apr 24<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/index/'>index</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/rails/'>rails</a>, <a class='category' href='/octopress/blog/categories/trick/'>trick</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/middleman-plus-pow-plus-livereload-plus-haml/">Middleman + Pow + Livereload + HAML</a></h1>
    <div class="entry">
        <p>原本今天要教同事怎樣寫HAML &amp; SCSS的，後來覺得HAML還要自己手動轉實在太麻煩，所以就講Middleman + guard-livereload了。</p>


        
        <a href="/octopress/blog/middleman-plus-pow-plus-livereload-plus-haml/" class="more-link">繼續閱讀 &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-12T15:14:00+08:00" pubdate data-updated="true">Apr 12<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/haml/'>haml</a>, <a class='category' href='/octopress/blog/categories/livereload/'>livereload</a>, <a class='category' href='/octopress/blog/categories/middleman/'>middleman</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/pow/'>pow</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/bei-media-queriesbiao-liao-%5B%3F%5D-xia/">被Media Queries婊了一下</a></h1>
    <div class="entry">
        <p>清明前一天，行銷同事告訴我某專案網站無法用IE 8開啟，到清明後一天才開始修正。一開始，找了老半天就是找不到任何錯誤，想說會不會是HTML 5的不支援問題導致的，可是開其他專案網站卻又都正常，後來發現到CSS中有用到Media Queries的部分，所以我拿掉之後IE 8就可以用了！</p>

<p>特此記錄一下T<sup>T&#8221;</sup></p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-04-05T18:28:00+08:00" pubdate data-updated="true">Apr 5<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/css3/'>css3</a>, <a class='category' href='/octopress/blog/categories/media-queries/'>media queries</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/paperclipde-default-url-style/">Paperclip的default_url Style</a></h1>
    <div class="entry">
        <p>用Paperclip的話一定會有用到特定尺寸的，可是當特定尺寸沒有上傳圖片的話要顯示特定尺寸的預設圖片該怎麼搞？</p>

<p>嗯，我現在有三種尺寸：<code>large, medium, thumb</code>，但我只要在<code>default_url</code>設定時加上<code>:style</code>就好，例如：</p>

<p><code>has_attached_file :image, {styles: {large: "", medium: "", thumb: ""}, default_url: "/path/to/missing/image/missing_:style.jpg"}</code></p>

<p>如此一來，如果<code>medium</code>沒有東西的話，它會自動帶出<code>missing_medium.jpg</code>來。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-03-29T15:59:00+08:00" pubdate data-updated="true">Mar 29<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/paperclip/'>paperclip</a>, <a class='category' href='/octopress/blog/categories/rails/'>rails</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/nginx-tunning/">Nginx Tunning</a></h1>
    <div class="entry">
        <p>準備讓公司的系統上線了，在調整Nginx的效能 &#8230;</p>

<p>參考這篇 <a href="http://v1nc3ntlaw.github.com/rubyconf-tw-2011-rails-sa/#13">http://v1nc3ntlaw.github.com/rubyconf-tw-2011-rails-sa/#13</a> 然後看了一下，看到<code>worker_processes 16;</code>感覺好像太高，畢竟我們公司的Server才1G RAM &#8230; 怕直接死掉XD</p>

<p>不過<code>nofile</code>的值我是設定<code>32768</code>，然後根據這篇 <a href="http://www.cnblogs.com/skyaspnet/archive/2010/09/02/1815749.html">http://www.cnblogs.com/skyaspnet/archive/2010/09/02/1815749.html</a> 設定了 <code>fs.file-max</code> 的值到<code>2390251</code></p>

<p><code>worker_connections</code>的部份則是參考這篇 <a href="http://hi.baidu.com/ugo5/blog/item/f4fb6037322059aed1a2d31b.html">http://hi.baidu.com/ugo5/blog/item/f4fb6037322059aed1a2d31b.html</a></p>

<p>不過若是可以，這篇也要參考一下 <a href="http://sudone.com/nginx/nginx_worker_processes.html">http://sudone.com/nginx/nginx_worker_processes.html</a></p>

<p>最大連接數的計算公式是：<code>worker_processes * worker_connections / 4</code>，而worker_connections最好超過9000的話，我是直接上到10240，所以我的設定檔大概長這樣：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>worker_processes 8;
</span><span class='line'>worker_rlimit_nofile 32768;
</span><span class='line'>
</span><span class='line'>events {
</span><span class='line'>  worker_connections 10240;
</span><span class='line'>  use epoll;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>上網查了一下，<code>epoll</code>似乎是Linux 2.6核心加入的功能，效能似乎不錯便加上去了。</p>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-03-28T15:32:00+08:00" pubdate data-updated="true">Mar 28<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/nginx/'>nginx</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/tunning/'>tunning</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/rails-best-practice-yu-refactor/">Rails Best Practice 與 Refactor</a></h1>
    <div class="entry">
        <p><code>rails_best_practices</code>是一個很不錯的Gem套件，它匯集了一些調整Rails Performace的小技巧，並且透過指令 <code>bundle exec rails_best_practice .</code>的方式就能夠列出你的問題，跳轉可以看到我噴了哪些東西XD</p>

<p>可以透過<code>gem rails_best_practices</code>來安裝，官方網站在 <a href="https://github.com/railsbp/rails_best_practices">https://github.com/railsbp/rails_best_practices</a></p>

<p>之後再慢慢列出解決的方式，這時真的發現有Git真好:P</p>


        
        <a href="/octopress/blog/rails-best-practice-yu-refactor/" class="more-link">繼續閱讀 &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-03-23T16:17:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/rails-best-practice/'>Rails Best Practice</a>, <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/rails/'>rails</a>, <a class='category' href='/octopress/blog/categories/refactor/'>refactor</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/octopress/blog/paperclip-shang-chuan-yan-zheng/">Paperclip 上傳驗證</a></h1>
    <div class="entry">
        <p>因為一些原因，需要驗證使用者是否有上傳照片，若有上傳照片才需要驗證檔案大小、檔案格式</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># model.rb</span>
</span><span class='line'>
</span><span class='line'><span class="n">validates_attachment_size</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">less_than</span><span class="p">:</span> <span class="mi">300</span><span class="o">.</span><span class="n">kilobytes</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span><span class="p">{</span><span class="o">|</span><span class="n">imports</span><span class="o">|</span> <span class="n">imports</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">uploaded_file</span><span class="o">.</span><span class="n">present?</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">validates_attachment_content_type</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">content_type</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpg&quot;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="k">if</span><span class="p">:</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span><span class="p">{</span><span class="o">|</span><span class="n">imports</span><span class="o">|</span> <span class="n">imports</span><span class="o">.</span><span class="n">avatar</span><span class="o">.</span><span class="n">uploaded_file</span><span class="o">.</span><span class="n">present?</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-03-23T11:44:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/octopress/blog/categories/notes/'>notes</a>, <a class='category' href='/octopress/blog/categories/paperclip/'>paperclip</a>, <a class='category' href='/octopress/blog/categories/rails/'>rails</a>
  
</div>

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
        <a href="/octopress/" class="prev">Prev</a>
    
    
        <a href="/octopress/blog/page/3/" class="next">Next</a>
    
    <a href="/octopress/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012 赫謙小便籤</footer>
	<script src="/octopress/javascripts/jquery.easing.1.3.js"></script>
<script src="/octopress/javascripts/jquery.fancybox.pack.js"></script>
<script src="/octopress/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'hechienstickies';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>